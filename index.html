<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LRI ì—”ì§„ í”„ë¡œí† íƒ€ì… ë°ëª¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #map-area { width: 800px; height: 400px; background-color: #e0e0e0; border: 1px solid #333; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        #result-box { margin-top: 20px; padding: 15px; border: 2px solid #ccc; white-space: pre-wrap; }
        .grade-red { color: white; background-color: red; padding: 5px; border-radius: 4px; font-weight: bold; }
        .grade-yellow { color: black; background-color: yellow; padding: 5px; border-radius: 4px; font-weight: bold; }
        .grade-green { color: white; background-color: green; padding: 5px; border-radius: 4px; font-weight: bold; }
        .hard-stop { border: 3px solid black; animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <h2>ğŸ“ LRI ì—”ì§„ ì‹œì—° (ë§µ í´ë¦­)</h2>
    <p>ë§µ ì˜ì—­ì„ í´ë¦­í•˜ì—¬ í•´ë‹¹ ê°€ìƒ ì¢Œí‘œì˜ LRIë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. (ì‹¤ì œ Mapbox/Leaflet ëŒ€ì‹  ë‹¨ìˆœ ë°•ìŠ¤ ì‚¬ìš©)</p>
    
    <div id="map-area">
        ë§µ í´ë¦­ ì‹œ LRI ê³„ì‚° ì‹œì‘ (Lat: 37.5, Lon: 127.0 ë“± ì„ì˜ ì¢Œí‘œ ì „ì†¡)
    </div>

    <div>
      <label for="scenario">Scenario:</label>
      <select id="scenario">
        <option value="random">random</option>
        <option value="very_good">very_good</option>
        <option value="severe">severe</option>
        <option value="warning">warning</option>
        <option value="hard_stop">hard_stop</option>
      </select>
    </div>

    <div id="result-box">
        ì—¬ê¸°ì— LRI ê³„ì‚° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
    </div>

    <script>
        document.getElementById('map-area').addEventListener('click', async function(event) {
            const mockLat = 37.5 + (Math.random() - 0.5) * 0.1;
            const mockLon = 127.0 + (Math.random() - 0.5) * 0.1;
            const scenario = document.getElementById('scenario').value;
            
            const resultBox = document.getElementById('result-box');
            resultBox.innerHTML = `â³ ${mockLat.toFixed(4)}, ${mockLon.toFixed(4)} ì¢Œí‘œ ë¶„ì„ ì¤‘...`;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/calculate_lri', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lat: mockLat, lon: mockLon, scenario })
                });

                if (!response.ok) {
                    throw new Error(`HTTP Error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                let gradeClass = '';
                if (data.Grade.includes('RED')) {
                    gradeClass = 'grade-red';
                } else if (data.Grade.includes('YELLOW')) {
                    gradeClass = 'grade-yellow';
                } else {
                    gradeClass = 'grade-green';
                }
                
                let gradeHtml = `<span class="${gradeClass}">${data.Grade} (LRI: ${data.LRI})</span>`;
                if (data.HardStop) {
                    gradeHtml = `<span class="${gradeClass} hard-stop">ğŸ›‘ ${data.Grade} (LRI: ${data.LRI})</span>`;
                }

                resultBox.innerHTML = `
                    <h3>âœ… ë¶„ì„ ê²°ê³¼ (${data.location})</h3>
                    <p><strong>ìµœì¢… ë“±ê¸‰:</strong> ${gradeHtml}</p>
                    <p><strong>3ëŒ€ ìœ„í—˜ ìš”ì†Œ ì ìˆ˜:</strong> V: ${data.V_score} / N: ${data.N_score} / S: ${data.S_score}</p>
                    
                    <h4>ğŸ“ ê·¼ê±° (ìœ„ì„± ë°ì´í„° ìœµí•©)</h4>
                    <ul>
                        ${data.Evidence.map(e => `<li>${e}</li>`).join('')}
                    </ul>
                `;

            } catch (error) {
                resultBox.innerHTML = `âŒ API í˜¸ì¶œ ì˜¤ë¥˜: ${error.message}. Python ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`;
            }
        });
    </script>
</body>
</html>